{
  "comments": [
    {
      "key": {
        "uuid": "da5c1566_2d874563",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6895
      },
      "writtenOn": "2018-06-06T13:38:38Z",
      "side": 1,
      "message": "Good find ! Didn\u0027t you query for entity owner for string \"bgp\". this would return ip address of the ODL node for BGP speaker.\nLet us call this api irrespective of ha or noha.",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_2879f393",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6745
      },
      "writtenOn": "2018-06-07T06:26:22Z",
      "side": 1,
      "message": "Hello Peri. I am not sure If Understand you correctly. Do you mean that there is some URL with will return the IP of BGP entity owner ? \nIf this is what you mean can you please provide to me that url because I do not know where to find it.\n\nAlso if we call this URL in noha is it going to work ?",
      "parentUuid": "da5c1566_2d874563",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_6873ebb1",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6895
      },
      "writtenOn": "2018-06-07T06:51:15Z",
      "side": 1,
      "message": "Yes, I just noticed netvirt is registering an ODL node as BGP speaker into entity-ownership service with \"bgp\" string as key. There is getOwnershipState(E forEntity) API from entity-ownership module which is used by netvirt. Not sure its also exposed as a REST RPC service. can you check it in restconf ?",
      "parentUuid": "da5c1566_2879f393",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_a864e3e5",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6745
      },
      "writtenOn": "2018-06-07T07:11:23Z",
      "side": 1,
      "message": "I checked it: we can use this URL [0] which has this response [1]\n\n[0]: http://192.0.2.7:8081/restconf/operational/entity-owners:entity-owners/entity-type/bgp\n\n[1] {\"entity-type\":[{\"type\":\"bgp\",\"entity\":[{\"id\":\"/general-entity:entity[general-entity:name\u003d\u0027bgp\u0027]\",\"candidate\":[{\"name\":\"member-0\"},{\"name\":\"member-1\"},{\"name\":\"member-2\"}],\"owner\":\"member-0\"}]}]}\n\n\nI think we can use this. What do you think ?",
      "parentUuid": "da5c1566_6873ebb1",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_28d57343",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6895
      },
      "writtenOn": "2018-06-07T08:21:53Z",
      "side": 1,
      "message": "Okay, Looks like it just provides owner as \"member-x\". Don\u0027t we need to find out ip address of this member node ? Even after retrieving it, i don\u0027t know what do you plan to do with it.\nI think we just need to find out on which ODL node zrpcd (on port 7644) running and make ODL to connect with it using bgp-connect.",
      "parentUuid": "da5c1566_a864e3e5",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_68464b25",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6745
      },
      "writtenOn": "2018-06-07T08:37:56Z",
      "side": 1,
      "message": "I am plannig to find out which member is the owner and after that I am going to ssh to evrey compute node and get the akka.conf file and ready the role variable in there. If the role variable is the same as the owner the we find out which ODL controller should we turn to BGP speaker.\n\nBut the patch is not ready let me write some code first and then we can discuss :)",
      "parentUuid": "da5c1566_28d57343",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_482c274b",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6895
      },
      "writtenOn": "2018-06-07T09:03:16Z",
      "side": 1,
      "message": "Sorry for commenting though it is not ready for review.\n\nAFAIK entity-ownership service is internal to ODL and not designed for external systems to make decisions based on this state.\nFor BGP, This service is being used start thrift server on port 6644, connect with zrpcd server (7644), etc. \nThough we run the bgp-connect command on any ODL node, finally ODL zrpcd thrift handshake happens from bgp entity member node.\n\nSo we just need to check on which ODL node zrpcd (on 7644) is running and make ODL to connect with it.\nI have discussed this with Dimitrios T earlier to check this out manually and adjust the testcase_3 accordingly.",
      "parentUuid": "da5c1566_68464b25",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_68b00bf5",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6745
      },
      "writtenOn": "2018-06-07T09:59:47Z",
      "side": 1,
      "message": "Yes you are right but the zrpcd service is running on all nodes\nwhen we deploy apex in HA. And apart from that we need to execute the odl:configure-bgp -op start-bgp-server from the odl node which is owner of the BGP entity. If we do not do that then the bgpd never starts.",
      "parentUuid": "da5c1566_482c274b",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_c8d037fa",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6895
      },
      "writtenOn": "2018-06-07T11:47:58Z",
      "side": 1,
      "message": "I can see (in ODL master code) start-bgp-server command can also run from any ODL nodes, but actual router configuration happens on the BGP entity owner ODL node. \n\nLet me include ODL BGP designer (Vyshakh) to comment on it.",
      "parentUuid": "da5c1566_68b00bf5",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_c8f7978b",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6745
      },
      "writtenOn": "2018-06-07T11:59:44Z",
      "side": 1,
      "message": "Yes ok let\u0027s wait Vyshakh to comment on this. In the meanwhile I will rerun the commands in case I missed something.",
      "parentUuid": "da5c1566_c8d037fa",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da5c1566_a83b4337",
        "filename": "sdnvpn/lib/utils.py",
        "patchSetId": 3
      },
      "lineNbr": 917,
      "author": {
        "id": 6745
      },
      "writtenOn": "2018-06-07T12:11:02Z",
      "side": 1,
      "message": "Yes you are right I tested it again. You can run the bgp speaker commands from any ODL controller in the cluster but the commands will actually executed in the BGP entity owner.\n\nSorry for this !\n\nSo the only thing we need to check is if the bgpd service is up on one out of the three OS controllers.",
      "parentUuid": "da5c1566_c8f7978b",
      "revId": "fc369dbdae8239c0cc232e7ee1cb0ca452562e41",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    }
  ]
}